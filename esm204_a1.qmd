---
title: "ESM 204: Homework #1"
author: "Natalie Smith and Olivia Hemond"
format: 
  html:
    code-fold: true
    toc: true
    number-sections: true
    embed-resources: true
theme: Lux
editor: visual
execute:
  echo: true
  message: false
  warning: false
---

```{r}
library(tidyverse)
library(kableExtra)
library(stats)
library(pracma)
```

### Basics of R:

a)  Launch RStudio and start a new R script (or markdown document, up to you!). Write a simple program that counts from 1 to 10 by increments of 0.5. Print out the results.

```{r}
# Count from 1 to 10 by increments of 0.5
count <- seq(from = 1, to = 10, by = 0.5)

# Print out the results
print(count)
```

b)  Write a custom function. Your function should have three inputs (X, a, and b) and one output (Y). The function should calculate Y = aX + b. Once you have created it, call your function for the values X=5, b=10, and a=3. What value of Y did you get? Confirm algebraically that it is correct.

```{r}
# write a custom function with three inputs (X,a,b) and one output (Y). The function should calculate Y = aX + b.
custom_function <- function(X, a, b){
  Y <- a*X + b
  return(Y)
}

# call the function for the values X=5, b=10, and a=3
custom_function(5, 3, 10)

```

c)  Build a dataframe. Your dataframe is going to call your function from above. We are going to fix a=3 and b=10, and we would like the dataframe to evaluate the function for integer values of X between 0 and 10. The columns of your dataframe should be: a, b, X, and Y. Print the resulting datafram

```{r}
# create a dataframe with columns a, b, X, and Y
df <- data.frame(a = 3, b = 10, X = 0:10, Y = custom_function(0:10, 3, 10))
print(df)

# Generate the kable table 
kable_table <- kable(df) %>%
  kable_styling()

kable_table

```

d)  Plot using your dataframe. Use ggplot to plot Y (vertical axis) against X (horizontal axis) from your dataframe.

```{r}
# plot Y (vertical axis) against X (horizontal axis) from the dataframe
ggplot(df, aes(x = X, y = Y)) +
  geom_point() +
  geom_line() +
  labs(title = "Y = 3X + 10",
       x = "X",
       y = "Y") +
  theme_minimal()

```

e)  Find the intersection of two curves. Use the function fzero (from the pracma package) or uniroot (from the stats package) to find where two curves cross. The two curves are:

(1)Y=a1X+b1

(2)Y=a2X+b2.

For any values of a1,b1,a2,and b2, we want to know the value of X and Y where these functions cross. To achieve this, follow these steps.

i)  Write a function called fun1 that takes X, a1, and b1 as inputs and delivers Y=a1X + b1 as the output. This is almost exactly the same as in part (b) above.

```{r}
fun1 <- function(X, a1, b1){
  Y <- a1*X + b1
  return(Y)
}
```

ii) Write a different function called fun2 that takes X, a2, and b2 as inputs and delivers Y=a2X + b2 as the output.

```{r}
fun2 <- function(X, a2, b2){
  Y <- a2*X + b2
  return(Y)
}
```

iii) Write a third function fun3 that takes the following inputs: X, a1, b1, a2, and b2. This new function will call the existing fun1 and fun2. The output is Z=fun1-fun2 (in other words, for any value of X, Z is the difference between the output of the two functions).

```{r}
fun3 <- function(X, a1, b1, a2, b2){
  a1 <- -2
  b1 <- 100
  a2 <- 3
  b2 <- 0.2
  Z <- fun1(X, a1, b1) - fun2(X, a2, b2)
  return(Z)
}
```

iv) Use fzero to find the value X\* where the two curves intersect, for the following values of the parameters: a1=-2, b1=100, a2=3, b2=0.2 What is the value of Y\*, the value of Y when the curves intersect?

```{r}
# use fzero to find the value X* where the two curves intersect
X_star <- fzero(fun3, c(0,50))

# find the value of Y* when the curves intersect
Y_star <- fun1(X_star[[1]], -2, 100)
```

f)  Use algebra to confirm that your answer to (e) is correct.

$$
y = -2x + 100 = 3x + 0.2
$$

$$
99.8 = 5x
$$

$$
x = 19.96
$$ $$
y = -2(19.96) + 100 = 60.08
$$

### Food Bank Markets

a)  Recall the NPR story, where food banks around the country can buy and sell surplus food in a new kind of market. Consider the supply and demand for peanut butter (the story indicated that it is particularly valuable in this market). In this market there are food banks who have surplus peanut butter and food banks that want more peanut butter. The currency is “credits” (not “dollars”). The demand curve for peanut butter is given by P = 500 - .1Q (where P has units “credits per jar” and Q has units “jars” of peanut butter). The supply of peanut butter is P = 5 + .05Q. What do you predict would be the equilibrium price and quantity of peanut butter that would be traded?

```{r}
# define the demand and supply functions
demand <- function(Q, a1, b1){
  P <- a1*Q + b1
  return(P)
}

supply <- function(Q, a2, b2){
  P <- a2*Q + b2
  return(P)
}

# find demand - supply
ds <- function(Q, a1, b1, a2, b2){
  a1 <- -0.1
  b1 <- 500
  a2 <- 0.05
  b2 <- 5
  Z <- fun1(Q, a1, b1) - fun2(Q, a2, b2)
  return(Z)
}

# use fzero to find the equilibrium price and quantity of peanut butter that would be traded
Q_star <- fzero(ds, c(0,5000))
P_star <- demand(Q_star[[1]], -0.1, 500)
print(c(Q_star[[1]], P_star))
```
The predicted equilibrium price of peanut butter is 170 credits per jar and the predicted equilibrium quantity is 3,300 jars.

b)  What is the benefit of the new market to food banks that buy peanut butter? What is the benefit of the new market to food banks that sell peanut butter?

COME BACK TO THIS !!!!!!!! The benefit of the new market to food banks that buy peanut butter

c)  A very large new food bank in New York City enters the market, with an individual demand for peanut butter given by P = 400 - 2Q. Draw the new aggregate demand curve in this market. What is the new equilibrium price?

```{r}
#flip the original demand function
flip_demand <- function(P, a1, b1){
  Q <- a1*P + b1
  return(Q)
}

# define the new demand function
new_demand <- function(P, a3, b3){
  Q <- a3*P + b3
  return(Q)
}

# make a data frame with the demand and aggregate demand functions
demand_df <- data.frame(P = 0:500, flip_demand = flip_demand(0:500, -10, 5000), new_demand = new_demand(0:500,-.5, 200)) %>% 
    mutate(new_demand=case_when(P>400~NA,
                              P<=400~new_demand)) %>% 
  rowwise() %>% 
  mutate(ag_demand = sum(flip_demand,new_demand,na.rm=TRUE))

#plot demand_df
ggplot(demand_df, aes(y = P))+
  geom_line(aes(x = flip_demand), color = "red") +
  geom_line(aes(x = new_demand), color = "blue") +
  geom_line(aes(x = ag_demand), color = "green") +
  labs(title = "Aggregate Demand for Peanut Butter",
       x = "Price (credits per jar)",
       y = "Quantity (jars)") +
  theme_minimal()
```

```{r}
# add the flipped demand functions to get an aggregate demand function
ag_demand <- function(P, a1, b1, a3, b3){
  a1 <- -10
  b1 <- 5000
  a3 <- -.5
  b3 <- 200
  Z <- flip_demand(P,a1, b1) + new_demand(P, a3, b3)
  return(Z)
}

# difference between aggregate demand and supply
ag_s <- function(P, Q, a1, b1, a2, b2, a3, b3){
  a1 <- -10
  b1 <- 5000
  a2 <- 3
  b2 <- 0.2
  a3 <- -.5
  b3 <- 200
  Z <- ag_demand(P, a1, b1, a3, b3) - supply(Q, a2, b2)
  return(Z)
}

# use fzero to find the new equilibrium price
Q_star_new <- fzero(ag_demand, c(0,500))
P_star_new <- supply(Q_star_new[[1]], 0.05, 5)
```

d\) Suppose that each jar of peanut butter that is traded generates carbon emissions due to fossil fuel intensive transport. This is called an “externality” and we will study them in detail throughout the course. Qualitatively, do you think this information should change the amount of peanut butter traded by food banks?

### Using R to solve more complicated supply and demand problems:

a\) Old cars are often fuel inefficient. The supply of inefficient old cars on the used carmarket is given by: P = 200 + 0.2Q \^ 1.2 (where P is dollar/car and Q is the quantity of cars). The state of California offers a “cash for clunkers” program, where they will pay \$2,000 for any inefficient old car. Answer the following questions:

```{r}

### Write functions

car_supply <- function(Q) {
  P <-  200 + (0.2*(Q^1.2))
  return(P)
}

car_demand <- function(Q) {
  P <- 2000 - Q*0
  return(P)
}
```

i.  Use R to determine how many cars will be sold back to the state under this program (you can round to the nearest integer)

ii.  Use R to calculate the elasticity of supply of inefficient cars, evaluated at the market equilibrium.

iii. What are the benefits of this policy to owners of old cars?

iv. What is the cost of this program to taxpayers (who fund the government

    payments)?

b\) Suppose the marginal benefit to society of removing old cars (this benefit comes from the environmental and health effects of removing fuel inefficient cars from the road) is given by: MB = 1000 – .01Q1.2 (where Q is the number of cars bought back under the program).

i\. Use R to find the socially optimal number of cars to remove (again, you can round to the nearest integer).

ii\. Use R to find the optimal “cash for clunkers” price (which may differ from the current price of \$2,000).
